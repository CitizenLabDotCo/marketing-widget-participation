<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community engagement tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* Custom font - Libre Franklin */
      @import url('https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@400;500;700&display=swap');
      body {
        font-family: 'Libre Franklin', sans-serif;
        background-color: #f7fafc; /* Tailwind gray-100 */
      }
      .button-selected {
        box-shadow: 0 0 0 2px #162466; /* royalBlue */
      }
      .progress-bar-filled {
        transition: width 0.3s ease-in-out;
      }
      .tips-list ul {
        list-style-type: disc;
        padding-left: 1.25rem; /* Equivalent to pl-5 in Tailwind */
      }
      .tips-list li {
        margin-bottom: 0.25rem; 
      }
      .filter-select {
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem; /* rounded-md */
        border: 1px solid #d1d5db; /* border-gray-300 */
        background-color: white;
        color: #1f2937; /* text-gray-800 */
        font-size: 0.875rem; /* text-sm */
      }
      .filter-select:focus {
        outline: 2px solid transparent;
        outline-offset: 2px;
        border-color: #162466; /* royalBlue on focus */
        box-shadow: 0 0 0 2px #162466;
      }
      .card-section-label {
        font-weight: bold;
        color: #374151; /* Tailwind gray-700 */
      }
      .card-section-content {
         color: #4b5563; /* Tailwind gray-600 */
      }
      .expand-arrow {
        transition: transform 0.2s ease-in-out;
      }
      .expanded .expand-arrow {
        transform: rotate(90deg);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    
    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;

      const CommunityEngagementTool = () => {
        const [currentStep, setCurrentStep] = useState(0);
        const [answers, setAnswers] = useState({});
        const [showResults, setShowResults] = useState(false);
        const [expandedMethods, setExpandedMethods] = useState({}); 

        const [filterMatchScore, setFilterMatchScore] = useState('all'); 
        const [filterDeliveryMode, setFilterDeliveryMode] = useState('all'); 
        const [filterResourceLevel, setFilterResourceLevel] = useState('all'); 

        const questions = [
          {
            id: 'impact',
            text: 'What is the level of community impact for your project?',
            options: [
              { label: 'Low - affects a small group or geographic area', value: 'low' },
              { label: 'Moderate - notable effects on a neighborhood or specific population', value: 'moderate' },
              { label: 'High - major community-wide implications', value: 'high' }
            ],
            multiSelect: false
          },
          {
            id: 'targetGroups',
            text: 'Which demographic groups are you specifically targeting? (Select all that apply)',
            options: [
              { label: 'General public', value: 'general' },
              { label: 'Youth/students', value: 'youth' },
              { label: 'Seniors/elderly', value: 'seniors' },
              { label: 'Immigrants/non-native speakers', value: 'immigrants' },
              { label: 'Low-income communities', value: 'lowIncome' },
              { label: 'People with disabilities', value: 'disabilities' },
              { label: 'Rural/remote communities', value: 'rural' },
              { label: 'Business/commercial sector', value: 'business' },
              { label: 'Racial/ethnic minorities', value: 'minorities' }
            ],
            multiSelect: true
          },
          {
            id: 'influence',
            text: 'What level of influence should the public have in this project?',
            options: [
              { label: 'Inform – providing clear information (no decision to influence)', value: 'inform' },
              { label: 'Consult – gathering feedback to inform your decision', value: 'consult' },
              { label: 'Involve – public discussion of options and meaningful feedback', value: 'involve' },
              { label: 'Collaborate – shared idea generation and discussion', value: 'collaborate' },
              { label: 'Empower – community co-decision through voting or delegation', value: 'empower' }
            ],
            multiSelect: false
          },
          {
            id: 'policyArea',
            text: 'What policy area does your project address?',
            options: [
              { label: 'Housing and land use', value: 'housing' },
              { label: 'Transportation and mobility', value: 'transportation' },
              { label: 'Parks and public spaces', value: 'parks' },
              { label: 'Health and wellbeing', value: 'health' },
              { label: 'Environment and sustainability', value: 'environment' },
              { label: 'Local economy and employment', value: 'economy' },
              { label: 'Education and youth services', value: 'education' },
              { label: 'Public services and infrastructure', value: 'infrastructure' },
              { label: 'Equity and inclusion', value: 'equity' }
            ],
            multiSelect: false
          },
          {
            id: 'digitalAccess',
            text: 'How would you rate the digital access and literacy in your target community?',
            options: [
              { label: 'High - most have reliable internet and digital skills', value: 'high' },
              { label: 'Mixed - varied access and comfort with technology', value: 'mixed' },
              { label: 'Limited - significant digital barriers exist', value: 'limited' }
            ],
            multiSelect: false
          },
          {
            id: 'resources',
            text: 'What resources are available for this engagement initiative?',
            options: [
              { label: 'Minimal - limited budget and staff time', value: 'minimal' },
              { label: 'Moderate - reasonable budget and staffing', value: 'moderate' },
              { label: 'Substantial - dedicated funding and personnel', value: 'substantial' }
            ],
            multiSelect: false
          }
        ];
        
        const engagementMethods = [
            {
                name: 'Project page on engagement platform',
                description: 'Dedicated online space with project information, resources, and engagement activities.',
                type: 'information', 
                deliveryMode: 'online', 
                resourceIntensity: 'minimal', 
                bestFor: {
                    impact: ['low', 'moderate', 'high'],
                    influence: ['inform', 'consult', 'involve'], 
                    digitalAccess: ['high', 'mixed'],
                    resources: ['minimal', 'moderate', 'substantial'],
                    demographicTargeting: ['general', 'youth', 'business']
                },
                whyThisWorks: 'Provides a central, accessible hub for all project-related information and activities, crucial for transparency and ongoing communication, regardless of other criteria. Essential for any level of influence.',
                tips: ['Ensure the page is kept up to date with current information and project milestones.', 'Highlight key project information clearly.', 'Use accessible design principles (e.g., WCAG).'],
                tools: "Go Vocal's engagement platform, visuals, downloadable resources, registration forms",
                blendIdeas: 'Promote the project page at in-person events with QR codes linking directly to the online space. Embed videos and infographics on the page.',
                always100: true
            },
            {
                name: 'Digital survey',
                description: 'Online questionnaires for collecting structured feedback.',
                type: 'engagement',
                deliveryMode: 'online',
                resourceIntensity: 'minimal',
                bestFor: {
                    impact: ['low', 'moderate', 'high'],
                    influence: ['consult'], 
                    digitalAccess: ['high', 'mixed'],
                    resources: ['minimal', 'moderate', 'substantial'],
                    demographicTargeting: ['general', 'youth', 'business']
                },
                whyThisWorks: 'Efficient for collecting broad feedback when digital access is good and resources might be limited. Good for quantifying opinions when consultation is the goal.',
                tips: ['Keep surveys concise (under 10 minutes to complete).', 'Use plain language and provide translations for diverse communities.', 'Pilot test your survey before wider distribution.'],
                tools: 'Online survey platforms, QR codes linking to mobile-friendly surveys',
                blendIdeas: 'Print QR codes on physical materials, have tablets available at in-person events for immediate survey completion.'
            },
            {
                name: 'In-person town hall',
                description: 'Public meetings where residents gather to hear presentations and provide comments.',
                type: 'engagement',
                deliveryMode: 'offline',
                resourceIntensity: 'moderate',
                bestFor: {
                    impact: ['moderate', 'high'],
                    influence: ['inform', 'consult', 'involve'],
                    digitalAccess: ['limited', 'mixed', 'high'],
                    resources: ['moderate', 'substantial'],
                    demographicTargeting: ['general', 'seniors', 'business', 'minorities']
                },
                whyThisWorks: 'Allows for direct interaction and can reach those with limited digital access, especially for projects with significant community impact. Good for informing, consulting, and involving the public.',
                tips: ['Schedule at varied times to accommodate different work schedules.', 'Provide childcare when possible.', 'Ensure the venue is accessible and welcoming.'],
                tools: 'Venue, presentation materials, feedback collection methods, facilitator',
                blendIdeas: 'Livestream the event for those who cannot attend, collect questions online beforehand, use digital polling during the event.'
            },
            {
                name: 'Virtual town hall',
                description: 'Online version of public meetings using video conferencing.',
                type: 'engagement',
                deliveryMode: 'online',
                resourceIntensity: 'minimal',
                bestFor: {
                    impact: ['moderate', 'high'],
                    influence: ['inform', 'consult', 'involve'],
                    digitalAccess: ['high', 'mixed'],
                    resources: ['minimal', 'moderate'],
                    demographicTargeting: ['general', 'youth', 'business', 'rural']
                },
                whyThisWorks: 'Increases accessibility for those who cannot attend in person, cost-effective for reaching a wide audience with good digital access for information sharing, consultation, or involvement.',
                tips: ['Provide clear instructions for joining.', 'Have technical support available.', 'Use interactive features like polls and Q&A.'],
                tools: 'Video conferencing software, digital presentation tools, moderators',
                blendIdeas: 'Offer viewing locations with staff support for those with limited digital access.'
            },
            {
                name: 'Interactive mapping',
                description: 'Geographic-based feedback where participants mark locations on maps.',
                type: 'engagement',
                deliveryMode: 'both',
                resourceIntensity: 'moderate',
                bestFor: {
                    impact: ['low', 'moderate', 'high'],
                    influence: ['consult', 'involve', 'collaborate'],
                    policyArea: ['housing', 'transportation', 'parks', 'environment', 'infrastructure'], 
                    digitalAccess: ['high', 'mixed'],
                    resources: ['moderate', 'substantial'],
                    demographicTargeting: ['general', 'youth', 'business']
                },
                whyThisWorks: 'Excellent for projects with a spatial component (like urban planning, mobility, or green spaces), allowing for specific, location-based feedback and collaborative planning.',
                tips: ['Ensure the interface is intuitive.', 'Provide clear instructions.', 'Define clear categories for comments if possible.'],
                tools: 'Digital mapping platform, printed maps for offline versions',
                blendIdeas: 'Combine digital maps with printed versions at community centers; staff can help digitize paper responses.'
            },
            {
                name: 'Focus groups',
                description: 'Moderated small group discussions to explore topics in depth.',
                type: 'engagement',
                deliveryMode: 'both',
                resourceIntensity: 'moderate',
                bestFor: {
                    impact: ['low', 'moderate', 'high'],
                    influence: ['consult', 'involve', 'collaborate'],
                    digitalAccess: ['limited', 'mixed', 'high'],
                    resources: ['moderate', 'substantial'],
                    demographicTargeting: ['youth', 'seniors', 'immigrants', 'minorities', 'disabilities', 'lowIncome']
                },
                whyThisWorks: 'Ideal for gaining nuanced understanding and exploring diverse perspectives from specific target groups, suitable for consultation, involvement, or collaboration.',
                tips: ['Recruit diverse participants.', 'Consider compensating people for their time.', 'Use a skilled, neutral facilitator.'],
                tools: 'Discussion guide, facilitator, recording method, location (physical or virtual)',
                blendIdeas: 'Offer both in-person and virtual focus groups. Use digital tools to capture and analyze comments.'
            },
            {
                name: 'Pop-up engagement',
                description: 'Temporary booths or activities at existing community events.',
                type: 'engagement',
                deliveryMode: 'offline',
                resourceIntensity: 'minimal',
                bestFor: {
                    impact: ['low', 'moderate'],
                    influence: ['inform', 'consult'],
                    digitalAccess: ['limited', 'mixed', 'high'],
                    resources: ['minimal', 'moderate'],
                    demographicTargeting: ['general', 'youth', 'seniors', 'immigrants', 'minorities']
                },
                whyThisWorks: 'Effective for reaching a broad audience by meeting people where they are, good for initial consultations and raising awareness with minimal resources. Can be combined with brief interviews.',
                tips: ['Go where people already are: farmers markets, festivals, school events.', 'Keep interactions brief and engaging.', 'Can be combined with brief interviews to gather qualitative insights.'],
                tools: 'Portable displays, engaging activities, quick feedback mechanisms (e.g., dot voting, comment cards), interview guides',
                blendIdeas: 'Use tablets for digital feedback, provide QR codes for later engagement. Conduct short, informal interviews and record key themes.'
            },
            {
                name: 'Participatory budgeting',
                description: 'Process where community members directly decide how to spend part of a public budget.',
                type: 'engagement',
                deliveryMode: 'both',
                resourceIntensity: 'substantial',
                bestFor: {
                    impact: ['moderate', 'high'],
                    influence: ['collaborate', 'empower'],
                    digitalAccess: ['mixed', 'high'],
                    resources: ['substantial'],
                    demographicTargeting: ['general', 'youth', 'seniors', 'lowIncome', 'minorities']
                },
                whyThisWorks: 'Empowers the community by giving them direct decision-making power over public funds, fostering high levels of ownership and trust. Best for collaborative or empowering influence levels.',
                tips: ['Build in education about budgeting.', 'Create transparent criteria for project eligibility.', 'Ensure the process is inclusive and accessible.'],
                tools: 'Project submission system, voting mechanism, financial assessment tools',
                blendIdeas: 'Combine digital voting with in-person idea development workshops and voting stations.'
            },
            {
                name: 'Mobile outreach unit',
                description: 'Bringing engagement to different neighborhoods or groups via a vehicle or traveling team.', 
                type: 'engagement',
                deliveryMode: 'offline',
                resourceIntensity: 'moderate', 
                bestFor: {
                    impact: ['low', 'moderate', 'high'],
                    influence: ['inform', 'consult', 'involve'],
                    digitalAccess: ['limited', 'mixed'], 
                    resources: ['moderate', 'substantial'], 
                    demographicTargeting: ['seniors', 'immigrants', 'lowIncome', 'rural', 'disabilities', 'youth', 'minorities'] 
                },
                whyThisWorks: 'Excellent for reaching geographically dispersed or hard-to-reach populations, including those with digital or mobility barriers. Allows for direct, personal interaction and interviews. Especially valuable when targeting seniors, youth, or minorities.',
                tips: ['Create a regular schedule so people know when to expect you.', 'Partner with trusted local organizations.', 'Use the opportunity for one-on-one interviews or small group discussions.', 'Effort can vary depending on resources; a simple setup can be minimal, while a fully equipped vehicle is substantial.'], 
                tools: 'Vehicle or portable setup, engagement activities, materials in multiple languages, interview guides',
                blendIdeas: 'Equip with tablets for digital engagement. Create a digital map showing the unit\'s location. Conduct and record interviews on site.'
            },
             {
                name: 'Social media information sharing',
                description: 'Using social platforms to share information about the project and direct people to engagement opportunities.',
                type: 'information',
                deliveryMode: 'online',
                resourceIntensity: 'minimal',
                bestFor: {
                    impact: ['low', 'moderate', 'high'],
                    influence: ['inform'],
                    digitalAccess: ['high', 'mixed'],
                    resources: ['minimal', 'moderate'],
                    demographicTargeting: ['general', 'youth', 'business'] 
                },
                whyThisWorks: 'Leverages existing networks for wide dissemination of information and directing traffic to primary engagement platforms, cost-effective for broad outreach when the goal is to inform.',
                tips: ['Use the Rule of Thirds: 1/3 project promotion, 1/3 sharing relevant content, 1/3 interaction.', 'Never use social media as the primary feedback collection method.', 'Tailor content to each platform.'],
                tools: 'Social media accounts, content calendar, visual creation tools',
                blendIdeas: 'Feature QR codes on physical materials that link to the Go Vocal engagement platform. Display social content at in-person events.'
            },
            {
                name: 'Community workshop series',
                description: 'Structured sessions for collaborative learning and problem-solving.',
                type: 'engagement',
                deliveryMode: 'both',
                resourceIntensity: 'moderate',
                bestFor: {
                    impact: ['moderate', 'high'],
                    influence: ['involve', 'collaborate', 'empower'],
                    digitalAccess: ['limited', 'mixed', 'high'],
                    resources: ['moderate', 'substantial'],
                    demographicTargeting: ['general', 'youth', 'seniors', 'minorities', 'immigrants', 'lowIncome']
                },
                whyThisWorks: 'Enables deep dives into complex issues and fosters collaborative solutions, particularly effective when aiming for higher levels of public influence like involvement or collaboration.',
                tips: ['Design interactive activities that build on each other.', 'Document process and outcomes visually.', 'Ensure a welcoming and inclusive environment.'],
                tools: 'Workshop materials, facilitator, documentation method',
                blendIdeas: 'Create hybrid workshops with some participants in-person and others joining virtually.'
            },
            {
                name: 'Design charrette',
                description: 'Intensive, multi-day collaborative design workshop.',
                type: 'engagement',
                deliveryMode: 'offline',
                resourceIntensity: 'substantial',
                bestFor: {
                    impact: ['moderate', 'high'],
                    influence: ['collaborate', 'empower'],
                    policyArea: ['housing', 'transportation', 'parks', 'infrastructure'],
                    digitalAccess: ['mixed', 'high'],
                    resources: ['substantial'],
                    demographicTargeting: ['general', 'youth', 'business', 'disabilities']
                },
                whyThisWorks: 'Highly collaborative and solution-oriented, best for projects requiring tangible design outcomes and deep public-expert interaction, especially when collaboration or empowerment is desired.',
                tips: ['Include design professionals alongside community members.', 'Build in time for iteration and feedback loops.', 'Clearly define the scope and objectives beforehand.'],
                tools: 'Design materials, facilitators with design expertise, workspace',
                blendIdeas: 'Use digital design tools that allow for real-time collaboration. Create a virtual gallery of design concepts.'
            },
            {
                name: 'Community walks/tours',
                description: 'Guided walks through areas relevant to the project.',
                type: 'engagement',
                deliveryMode: 'offline',
                resourceIntensity: 'minimal',
                bestFor: {
                    impact: ['low', 'moderate'],
                    influence: ['consult', 'involve'],
                    policyArea: ['housing', 'transportation', 'parks', 'environment', 'infrastructure'],
                    digitalAccess: ['limited', 'mixed', 'high'],
                    resources: ['minimal', 'moderate'],
                    demographicTargeting: ['general', 'seniors', 'youth', 'minorities']
                },
                whyThisWorks: 'Provides contextual understanding and direct observation, making abstract project details more tangible for participants. Good for consultation and initial involvement.',
                tips: ['Consider accessibility needs.', 'Use a structured observation guide to focus feedback.', 'Encourage participants to share their lived experiences of the area.'],
                tools: 'Route planning, note-taking system, possibly recording equipment',
                blendIdeas: 'Create a digital map with geotagged comments. Develop a mobile app for self-guided tours.'
            },
            {
                name: 'Text/SMS and WhatsApp campaigns',
                description: 'Using messaging apps for outreach and simple feedback collection.',
                type: 'engagement', 
                deliveryMode: 'online',
                resourceIntensity: 'minimal',
                bestFor: {
                    impact: ['low', 'moderate', 'high'],
                    influence: ['inform', 'consult'],
                    digitalAccess: ['limited', 'mixed', 'high'], 
                    resources: ['minimal', 'moderate'],
                    demographicTargeting: ['general', 'youth', 'immigrants', 'lowIncome', 'rural']
                },
                whyThisWorks: 'Reaches a wide audience directly on their mobile devices, good for quick updates, reminders, and simple polls, especially in areas with varied digital literacy. Useful for informing or light consultation.',
                tips: ['Keep messages brief.', 'Be clear about opt-in/opt-out.', 'WhatsApp community functionality is free and allows for group discussions.', 'Use for reminders about other engagement opportunities.'],
                tools: 'Text messaging platform, WhatsApp groups, contact database, response management system',
                blendIdeas: 'Promote messaging campaigns at in-person events. Use QR codes that automatically connect to WhatsApp groups or sign-up forms.'
            },
            {
                name: 'Citizens\' assembly',
                description: 'Structured dialogue where participants weigh trade-offs and seek common ground.',
                type: 'engagement',
                deliveryMode: 'both',
                resourceIntensity: 'substantial',
                bestFor: {
                    impact: ['moderate', 'high'],
                    influence: ['consult'], 
                    digitalAccess: ['mixed', 'high'],
                    resources: ['substantial'], 
                    demographicTargeting: ['general', 'seniors', 'business', 'minorities'] 
                },
                whyThisWorks: 'Enables deep, informed deliberation on complex issues by a representative group of citizens, leading to well-considered recommendations. Only suitable for consultation with substantial resources.',
                tips: ['Provide balanced information beforehand.', 'Use skilled facilitators for complex topics.', 'Requires substantial resources and time commitment.', 'Ensure a demographically representative selection of participants.'],
                tools: 'Discussion guide, background materials, trained facilitators, documentation method, participant selection process',
                blendIdeas: 'Offer pre-reading and discussion questions online. Create hybrid forums with virtual participation options for some segments.'
            },
            {
                name: 'Videos',
                description: 'Digital video content that conveys information or encourages engagement.',
                type: 'information',
                deliveryMode: 'online',
                resourceIntensity: 'moderate',
                bestFor: {
                    impact: ['low', 'moderate', 'high'],
                    influence: ['inform'],
                    digitalAccess: ['high', 'mixed'],
                    resources: ['moderate', 'substantial'],
                    demographicTargeting: ['general', 'youth', 'seniors', 'immigrants', 'minorities'] 
                },
                whyThisWorks: 'Engaging way to present complex information visually, good for reaching audiences who prefer visual content over text, primarily for informing. Highly effective for youth and general public.',
                tips: ['Keep videos short (under 5 minutes for informational, longer for recorded events).', 'Include variety in presentation styles and visuals.', 'Add closed captioning and transcripts for accessibility.'],
                tools: 'Video recording equipment (can be a smartphone), editing software (many free options), hosting platform (YouTube, Vimeo, or self-hosted)',
                blendIdeas: 'Show videos at in-person events. Include QR codes on printed materials linking to video content. Use short clips on social media.'
            },
            {
                name: 'Infographics',
                description: 'Visual representations of data and information to simplify complex concepts.',
                type: 'information',
                deliveryMode: 'both', 
                resourceIntensity: 'minimal', 
                bestFor: {
                    impact: ['low', 'moderate', 'high'],
                    influence: ['inform'],
                    digitalAccess: ['limited', 'mixed', 'high'],
                    resources: ['minimal', 'moderate'],
                    demographicTargeting: ['general', 'youth', 'business', 'seniors']
                },
                whyThisWorks: 'Makes complex data and information easily digestible and shareable, effective for quick understanding when the goal is to inform.',
                tips: ['Focus on visual appeal with clear, simple messaging.', 'Use data that matters to your audience.', 'Simplify complex information into key takeaways.'],
                tools: 'Graphic design software (e.g., Canva, Piktochart), data visualization tools',
                blendIdeas: 'Print infographics for displays at community events. Share digitally on website and social platforms. Include in email newsletters.'
            },
            {
                name: 'Offline communications (flyers, letters, posters)',
                description: 'Physical printed materials for broad information dissemination or targeted outreach.',
                type: 'information',
                deliveryMode: 'offline',
                resourceIntensity: 'moderate', 
                bestFor: {
                    impact: ['low', 'moderate', 'high'],
                    influence: ['inform'],
                    digitalAccess: ['limited', 'mixed'], 
                    resources: ['moderate', 'substantial'],
                    demographicTargeting: ['general', 'seniors', 'immigrants', 'lowIncome', 'rural']
                },
                whyThisWorks: 'Essential for reaching community members with limited or no digital access, provides tangible information when the primary goal is to inform. Always a highly relevant foundational communication method.',
                tips: ['Use clear, large font and simple language.', 'Include translations for key demographic groups.', 'Provide clear contact information and next steps.', 'Strategically place posters in high-traffic community locations.'],
                tools: 'Graphic design software, printing services, distribution methods (mail, hand-delivery, community noticeboards)',
                blendIdeas: 'Include QR codes on printed materials linking to online project pages or surveys. Announce in-person events through flyers.',
                alwaysHighlyRecommended: true 
            },
             {
                name: 'Email newsletter',
                description: 'Regular email updates to subscribers about project progress and engagement opportunities.',
                type: 'information',
                deliveryMode: 'online',
                resourceIntensity: 'minimal',
                bestFor: {
                    impact: ['low', 'moderate', 'high'],
                    influence: ['inform'],
                    digitalAccess: ['mixed', 'high'],
                    resources: ['minimal', 'moderate'],
                    demographicTargeting: ['general', 'business', 'seniors', 'youth'] 
                },
                whyThisWorks: 'Keeps an interested audience informed directly, good for sharing detailed updates, links, and calls to action, primarily for informational purposes.',
                tips: ['Maintain a consistent schedule.', 'Keep content concise and scannable with clear headings.', 'Use visuals to break up text.', 'Ensure mobile-friendliness.', 'Provide clear unsubscribe options.'],
                tools: 'Email marketing platform (e.g., Mailchimp, SendGrid, or simpler list management), content creation tools',
                blendIdeas: 'Promote newsletter sign-ups at all events (online and offline). Archive newsletters on the project webpage.'
            }
        ];


        const handleSelect = (value) => {
          let updatedAnswers;
          const currentQuestion = questions[currentStep];
          if (currentQuestion.multiSelect) {
            const currentValues = answers[currentQuestion.id] || [];
            if (currentValues.includes(value)) {
              updatedAnswers = { ...answers, [currentQuestion.id]: currentValues.filter(v => v !== value) };
            } else {
              updatedAnswers = { ...answers, [currentQuestion.id]: [...currentValues, value] };
            }
            setAnswers(updatedAnswers);
          } else {
            updatedAnswers = { ...answers, [currentQuestion.id]: value };
            setAnswers(updatedAnswers);
            if (currentStep < questions.length - 1) setCurrentStep(currentStep + 1);
            else setShowResults(true);
          }
        };

        const handleContinue = () => {
          if (currentStep < questions.length - 1) setCurrentStep(currentStep + 1);
          else setShowResults(true);
        };

        const handleBack = () => {
          if (!showResults && currentStep > 0) {
            setCurrentStep(currentStep - 1);
          }
        };
        
        const handleRestart = () => {
          setCurrentStep(0);
          setAnswers({});
          setShowResults(false);
          setFilterMatchScore('all');
          setFilterDeliveryMode('all');
          setFilterResourceLevel('all');
        };

        const getInfluenceDescription = (level) => {
            const q = questions.find(q => q.id === 'influence');
            const option = q ? q.options.find(o => o.value === level) : null;
            return option ? option.label.split('–')[1]?.trim() || level : level;
        };
        
        const generateRecap = () => {
            let projectType = answers.policyArea ? (questions.find(q=>q.id === 'policyArea').options.find(o=>o.value === answers.policyArea)?.label.toLowerCase() || answers.policyArea) : "[project type]";
            let targetAudience = "the community";
            if (answers.targetGroups && answers.targetGroups.length > 0) {
                const groupLabels = answers.targetGroups.map(val => questions.find(q=>q.id === 'targetGroups').options.find(o=>o.value === val)?.label.toLowerCase() || val);
                if (groupLabels.length === 1) {
                    targetAudience = groupLabels[0];
                } else if (groupLabels.length === 2) {
                    targetAudience = `${groupLabels[0]} and ${groupLabels[1]}`;
                } else {
                    const lastGroup = groupLabels.pop();
                    targetAudience = `${groupLabels.join(', ')}, and ${lastGroup}`;
                }
            }
            let resourceLevel = answers.resources ? `${answers.resources}` : "[resource level]";
            let digitalAccess = answers.digitalAccess ? `${answers.digitalAccess} digital access` : "[digital access]";
            let impactLevelText = answers.impact ? `the project has a ${answers.impact} community impact level` : "the project has an [impact level] community impact";
            let involvementLevel = answers.influence ? `${getInfluenceDescription(answers.influence).toLowerCase()}` : "[involvement level]";

            return `You’re designing an engagement plan for a ${projectType} project focused on ${targetAudience}. With ${resourceLevel} resources and ${digitalAccess}, ${impactLevelText} and public involvement through ${involvementLevel}. Based on that, here’s what we recommend:`;
        };

        const calculateMatches = () => {
          let methodsWithScores = engagementMethods.map(method => {
            if (method.always100) {
              return { ...method, matchScore: Object.keys(answers).length, matchPercentage: 100, relevantCriteria: Object.keys(answers).length };
            }
             if (method.alwaysHighlyRecommended) { 
              return { ...method, matchScore: Object.keys(answers).length, matchPercentage: 98, relevantCriteria: Object.keys(answers).length }; 
            }

            let score = 0;
            let maxScore = 0;
            let relevantCriteria = 0;

            for (const [key, value] of Object.entries(answers)) {
              if (!value || !method.bestFor || !method.bestFor[key]) continue;
              relevantCriteria++;
              maxScore++;
              if (Array.isArray(value)) {
                if (value.some(v => method.bestFor[key].includes(v))) score++;
              } else {
                if (method.bestFor[key].includes(value)) score++;
              }
            }
            
            if (answers.targetGroups && method.bestFor && method.bestFor.demographicTargeting) {
              const selectedGroups = answers.targetGroups || [];
              const methodTargeting = method.bestFor.demographicTargeting || [];
              relevantCriteria++; 
              maxScore++;
              const matchingGroups = selectedGroups.filter(group => methodTargeting.includes(group));
              if (matchingGroups.length > 0 && matchingGroups.length >= selectedGroups.length / 2) {
                score++;
              }
            }
            
            let percentage = maxScore > 0 ? Math.round((score / maxScore) * 100) : 0; 

            // Specific boosts/caps
            if (method.name === 'Mobile outreach unit' && answers.targetGroups) {
                const targetedSensitiveGroups = ['minorities', 'youth', 'seniors'];
                if (answers.targetGroups.some(group => targetedSensitiveGroups.includes(group))) {
                    percentage = Math.max(percentage, 90); 
                }
            }
            if (method.name === 'Videos' && answers.targetGroups) {
                if (answers.targetGroups.includes('youth') || answers.targetGroups.includes('general')) {
                     percentage = Math.max(percentage, 85); 
                }
            }
            if (method.name === 'Social media information sharing' && answers.targetGroups && answers.targetGroups.includes('seniors')) {
                percentage = Math.min(percentage, 60); 
            }
            if (method.name === 'Citizens\' assembly') {
                if (!(answers.influence === 'consult' && answers.resources === 'substantial')) {
                    percentage = 0; 
                } else {
                    percentage = maxScore > 0 ? Math.max(percentage, 75) : 75; 
                }
            }
            if (method.name === 'Interactive mapping' && answers.policyArea) {
                const urbanPlanningRelated = ['housing', 'transportation', 'parks', 'environment', 'infrastructure'];
                if (answers.policyArea === 'health') {
                    if (percentage > 0) { 
                        percentage = Math.min(Math.max(percentage, 60), 70);
                    } else {
                        percentage = 0; 
                    }
                } else if (!urbanPlanningRelated.includes(answers.policyArea)) {
                    percentage = Math.min(percentage, 79);
                }
            }
            if (method.name === 'In-person town hall' || method.name === 'Virtual town hall') {
                percentage = Math.min(percentage, 75);
            }

            return { ...method, matchScore: score, matchPercentage: percentage, relevantCriteria };
          });

          const socialMediaMethod = methodsWithScores.find(m => m.name === 'Social media information sharing');
          const videoMethodIndex = methodsWithScores.findIndex(m => m.name === 'Videos');

          if (socialMediaMethod && videoMethodIndex !== -1) {
            if (methodsWithScores[videoMethodIndex].matchPercentage > socialMediaMethod.matchPercentage) {
              methodsWithScores[videoMethodIndex].matchPercentage = socialMediaMethod.matchPercentage;
            }
          }
          
          return methodsWithScores
            .filter(method => method.relevantCriteria > 0 || method.always100 || method.alwaysHighlyRecommended)
            .sort((a, b) => b.matchPercentage - a.matchPercentage);
        };
        
        const filteredAndGroupedMethods = useMemo(() => {
            let methods = calculateMatches();

            if (filterMatchScore !== 'all') {
                methods = methods.filter(m => {
                    if (filterMatchScore === '80+') return m.matchPercentage >= 80;
                    if (filterMatchScore === '50-79') return m.matchPercentage >= 50 && m.matchPercentage < 80;
                    if (filterMatchScore === '<50') return m.matchPercentage < 50;
                    return true;
                });
            }
            if (filterDeliveryMode !== 'all') {
                methods = methods.filter(m => m.deliveryMode === filterDeliveryMode || (m.deliveryMode === 'both' && (filterDeliveryMode === 'online' || filterDeliveryMode === 'offline')));
            }
            if (filterResourceLevel !== 'all') {
                methods = methods.filter(m => m.resourceIntensity === filterResourceLevel);
            }
            
            const high = methods.filter(m => m.matchPercentage >= 80);
            const medium = methods.filter(m => m.matchPercentage >= 50 && m.matchPercentage < 80);
            const low = methods.filter(m => m.matchPercentage < 50);

            return {
                highMatches: {
                    information: high.filter(m => m.type === 'information'),
                    engagement: high.filter(m => m.type === 'engagement')
                },
                mediumMatches: {
                    information: medium.filter(m => m.type === 'information'),
                    engagement: medium.filter(m => m.type === 'engagement')
                },
                lowMatches: {
                    information: low.filter(m => m.type === 'information'),
                    engagement: low.filter(m => m.type === 'engagement')
                },
                allFiltered: methods 
            };
        }, [answers, filterMatchScore, filterDeliveryMode, filterResourceLevel]);


        const goVocalColors = {
          royalBlue: '#162466', salmon: '#E14C62', yellow: '#FFBE00',
          mint: '#C2ECE0', lightBlue: '#e8eaf3', highRecommendBg: '#E2F7F1', 
        };

        const renderTips = (tipsArray) => {
          if (!tipsArray || tipsArray.length === 0) return <p className={cardSectionContentStyle}>N/A</p>;
          return (
            <ul className="list-disc pl-5 space-y-1">
              {tipsArray.map((tip, index) => (<li key={index} className={cardSectionContentStyle}>{tip}</li>))}
            </ul>
          );
        };

        const cardSectionBaseStyle = "text-xs sm:text-sm";
        const cardSectionLabelStyle = `${cardSectionBaseStyle} font-bold text-gray-800`; 
        const cardSectionContentStyle = `${cardSectionBaseStyle} text-gray-600`; 

        const toggleExpandMethod = (methodName) => {
          setExpandedMethods(prev => ({
            ...prev,
            [methodName]: !prev[methodName]
          }));
        };

        const renderMethodCard = (method, category) => {
          const isExpanded = !!expandedMethods[method.name];
          const showDetailsClass = isExpanded ? 'block' : 'hidden';

          return (
            <div key={method.name} className="p-4 border rounded-lg"
              style={{ 
                borderColor: category === 'high' ? goVocalColors.royalBlue : (category === 'medium' ? goVocalColors.royalBlue : '#d1d5db'), 
                backgroundColor: category === 'high' ? goVocalColors.highRecommendBg : (category === 'medium' ? goVocalColors.lightBlue : '#f9fafb')
              }}>
              <div 
                className="flex flex-col sm:flex-row justify-between sm:items-center mb-2 cursor-pointer md:cursor-default"
                onClick={() => window.innerWidth < 768 && toggleExpandMethod(method.name)} 
              >
                <h4 className="text-md sm:text-lg font-semibold mb-1 sm:mb-0" style={{ color: goVocalColors.royalBlue }}>
                  {method.name}
                </h4>
                <div className="flex items-center self-start sm:self-center">
                    <span className="px-2 py-1 rounded-full text-xs sm:text-sm font-medium"
                        style={{ backgroundColor: category === 'high' || category === 'medium' ? goVocalColors.royalBlue : '#e5e7eb', color: category === 'high' || category === 'medium' ? 'white' : goVocalColors.royalBlue }}>
                        {method.matchPercentage}% match
                    </span>
                    <span className={`md:hidden ml-2 expand-arrow ${isExpanded ? 'expanded' : ''}`}>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5" style={{ color: goVocalColors.royalBlue }}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                        </svg>
                    </span>
                </div>
              </div>
              <p className={`${cardSectionContentStyle} mb-3`}>{method.description}</p>
              
              <div className={`${showDetailsClass} md:block`}>
                {method.whyThisWorks && (
                  <div className="why-this-works my-3"> 
                    <span className={cardSectionLabelStyle}>Why this works:</span> <span className={cardSectionContentStyle}>{method.whyThisWorks}</span>
                  </div>
                )}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                  <div className="tips-list">
                    <h5 className={cardSectionLabelStyle}>Tips:</h5>
                    {renderTips(method.tips)}
                  </div>
                  <div>
                    <h5 className={cardSectionLabelStyle}>Tools needed:</h5>
                    <p className={cardSectionContentStyle}>{method.tools}</p>
                  </div>
                </div>
                <div className="mt-3">
                  <h5 className={cardSectionLabelStyle}>Blended engagement ideas:</h5>
                  <p className={cardSectionContentStyle}>{method.blendIdeas}</p>
                </div>
              </div>
            </div>
          );
        }
        
        const renderMethodSection = (title, methods, category) => {
            const { information, engagement } = methods;
            const onlyShowInformation = answers.influence === 'inform';

            if (onlyShowInformation && information.length === 0) return null;
            if (!onlyShowInformation && information.length === 0 && engagement.length === 0) return null;

            return (
                <div className={category !== 'high' ? "mt-6" : ""}>
                    <h3 className="text-md sm:text-lg font-medium mb-3" style={{ color: goVocalColors.royalBlue }}>
                        {title}
                    </h3>
                    {information.length > 0 && (
                        <div className="mb-4">
                            <h4 className="text-sm sm:text-md font-semibold mb-2" style={{color: goVocalColors.salmon}}>Information methods</h4>
                            <div className="space-y-4">
                                {information.map(method => renderMethodCard(method, category))}
                            </div>
                        </div>
                    )}
                    {!onlyShowInformation && engagement.length > 0 && (
                         <div className={information.length > 0 ? "mt-6" : ""}> 
                            <h4 className="text-sm sm:text-md font-semibold mb-2" style={{color: goVocalColors.salmon}}>Engagement methods</h4>
                            <div className="space-y-4">
                                {engagement.map(method => renderMethodCard(method, category))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };


        return (
          <div className="p-4 sm:p-6 max-w-4xl mx-auto bg-white rounded-lg shadow-xl my-8">
            <div className="flex items-center justify-center mb-6">
              <img 
                src="https://cdn.prod.website-files.com/6556520d8c847251fa8d66c1/663cdbaf9d3a55cb97ff2486_Formerly_Blue%2BPink_NL.svg" 
                alt="Community engagement logo" 
                className="h-10 sm:h-12" 
              />
            </div>
            <h1 className="text-xl sm:text-2xl font-bold text-center mb-6 sm:mb-8" style={{ color: goVocalColors.royalBlue }}>
              Community engagement method selector
            </h1>

            {!showResults ? (
              <div className="question-container">
                <div className="mb-4">
                  <div className="w-full rounded-full h-2.5" style={{ backgroundColor: goVocalColors.lightBlue }}>
                    <div 
                      className="h-2.5 rounded-full progress-bar-filled" 
                      style={{
                        width: `${((currentStep + 1) / questions.length) * 100}%`,
                        backgroundColor: goVocalColors.salmon
                      }}
                    ></div>
                  </div>
                  <span className="text-xs sm:text-sm mt-1 block" style={{ color: goVocalColors.royalBlue }}>
                    Question {currentStep + 1} of {questions.length}
                  </span>
                </div>

                <h2 className="text-lg sm:text-xl font-semibold mb-4" style={{ color: goVocalColors.royalBlue }}>
                  {questions[currentStep].text}
                </h2>

                <div className="grid gap-2 sm:gap-3">
                  {questions[currentStep].options.map((option) => {
                    const isSelected = questions[currentStep].multiSelect
                      ? (answers[questions[currentStep].id] || []).includes(option.value)
                      : answers[questions[currentStep].id] === option.value;

                    return (
                      <button
                        key={option.value}
                        onClick={() => handleSelect(option.value)}
                        className={`p-3 border rounded-md text-left transition-colors duration-150 ease-in-out ${
                          isSelected ? 'button-selected' : 'hover:bg-gray-50'
                        }`}
                        style={isSelected
                          ? { backgroundColor: goVocalColors.lightBlue, borderColor: goVocalColors.royalBlue, color: goVocalColors.royalBlue, fontWeight: '500' }
                          : { backgroundColor: 'white', borderColor: '#d1d5db' }}
                      >
                        {questions[currentStep].multiSelect ? (
                          <div className="flex items-center">
                            <div 
                              className="w-5 h-5 mr-3 border rounded flex items-center justify-center flex-shrink-0" 
                              style={
                                isSelected
                                  ? { backgroundColor: goVocalColors.royalBlue, borderColor: goVocalColors.royalBlue, color: 'white' }
                                  : { borderColor: '#9ca3af' } 
                              }
                            >
                              {isSelected && <span className="text-xs">✓</span>}
                            </div>
                            <span className="text-sm sm:text-base">{option.label}</span>
                          </div>
                        ) : (
                          <span className="text-sm sm:text-base">{option.label}</span>
                        )}
                      </button>
                    );
                  })}
                </div>

                <div className="mt-6 flex justify-between items-center">
                  {currentStep > 0 && (
                    <button
                      onClick={handleBack}
                      className="px-4 py-2 rounded-md text-sm sm:text-base transition-colors duration-150 ease-in-out hover:bg-gray-200"
                      style={{ backgroundColor: goVocalColors.lightBlue, color: goVocalColors.royalBlue }}
                    >
                      Back
                    </button>
                  )}
                  {currentStep === 0 && !questions[currentStep].multiSelect && <div />}
                  {currentStep === 0 && questions[currentStep].multiSelect && <div />}


                  {questions[currentStep].multiSelect && (
                    <button
                      onClick={handleContinue}
                      className="px-4 py-2 text-white rounded-md text-sm sm:text-base transition-opacity duration-150 ease-in-out"
                      style={{
                        backgroundColor: goVocalColors.salmon,
                        opacity: (answers[questions[currentStep].id] || []).length === 0 ? 0.5 : 1
                      }}
                      disabled={(answers[questions[currentStep].id] || []).length === 0}
                    >
                      Continue
                    </button>
                  )}
                </div>
              </div>
            ) : (
              <div className="results-container">
                <h2 className="text-lg sm:text-xl font-semibold mb-4" style={{ color: goVocalColors.royalBlue }}>
                  Recommended engagement methods
                </h2>
                
                <div className="mb-6 p-4 rounded-lg text-sm sm:text-base" style={{ backgroundColor: goVocalColors.lightBlue, color: goVocalColors.royalBlue }}>
                  <p>{generateRecap()}</p>
                </div>

                {/* Filter Bar */}
                <div className="mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50">
                    <h4 className="text-md font-semibold mb-3" style={{color: goVocalColors.royalBlue}}>Filter recommendations:</h4>
                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div>
                            <label htmlFor="filterMatchScore" className="block text-xs font-medium text-gray-700 mb-1">Match score</label>
                            <select id="filterMatchScore" value={filterMatchScore} onChange={e => setFilterMatchScore(e.target.value)} className="filter-select w-full">
                                <option value="all">All scores</option>
                                <option value="80+">80%+ match</option>
                                <option value="50-79">50-79% match</option>
                                <option value="<50">&lt;50% match</option>
                            </select>
                        </div>
                        <div>
                            <label htmlFor="filterDeliveryMode" className="block text-xs font-medium text-gray-700 mb-1">Delivery mode</label>
                            <select id="filterDeliveryMode" value={filterDeliveryMode} onChange={e => setFilterDeliveryMode(e.target.value)} className="filter-select w-full">
                                <option value="all">All modes</option>
                                <option value="online">Online</option>
                                <option value="offline">In-person</option>
                                <option value="both">Blended</option>
                            </select>
                        </div>
                        <div>
                            <label htmlFor="filterResourceLevel" className="block text-xs font-medium text-gray-700 mb-1">Resource intensity</label>
                            <select id="filterResourceLevel" value={filterResourceLevel} onChange={e => setFilterResourceLevel(e.target.value)} className="filter-select w-full">
                                <option value="all">All levels</option>
                                <option value="minimal">Minimal</option>
                                <option value="moderate">Moderate</option>
                                <option value="substantial">Substantial</option>
                            </select>
                        </div>
                    </div>
                </div>


                <div className="space-y-6">
                    {renderMethodSection('Highly recommended (80%+ match)', filteredAndGroupedMethods.highMatches, 'high')}
                    {renderMethodSection('Good options (50-79% match)', filteredAndGroupedMethods.mediumMatches, 'medium')}
                    {renderMethodSection('Other options to consider (<50% match)', filteredAndGroupedMethods.lowMatches, 'low')}

                    {filteredAndGroupedMethods.allFiltered.length === 0 && (
                        <div className="p-4 border rounded-lg text-sm sm:text-base" style={{ borderColor: goVocalColors.yellow, backgroundColor: '#fffbeb' }}>
                        <p>No methods match the current filter criteria. Try adjusting your filters or restarting the questionnaire.</p>
                        </div>
                    )}
                </div>

                <div className="mt-8 flex flex-col sm:flex-row gap-4">
                  <button
                    onClick={handleRestart}
                    className="px-4 py-2 text-white rounded-md text-sm sm:text-base transition-colors duration-150 ease-in-out hover:opacity-90"
                    style={{ backgroundColor: goVocalColors.salmon }}
                  >
                    Start over
                  </button>
                </div>

                <div className="mt-8 p-4 rounded-lg" style={{ backgroundColor: goVocalColors.mint }}>
                  <h3 className="text-md sm:text-lg font-medium mb-2" style={{ color: goVocalColors.royalBlue }}>
                    Blended engagement strategy tips
                  </h3>
                  <ul className="list-disc pl-5 space-y-2 text-sm sm:text-base text-gray-700">
                    <li>Consider using multiple methods to reach different segments of your community.</li>
                    <li>Bridge digital and in-person experiences by using QR codes, tablets at events, and livestreaming.</li>
                    <li>Make all materials accessible in multiple languages and formats.</li>
                    <li>For greater inclusion, combine high-tech and low-tech options.</li>
                    <li>Track participation demographics to ensure representative engagement.</li>
                  </ul>
                </div>
              </div>
            )}
          </div>
        );
      };

      const container = document.getElementById('root');
      const root = ReactDOM.createRoot(container);
      root.render(<CommunityEngagementTool />);
    </script>
  </body>
</html>
